{"version":3,"sources":["../src/webcam.js"],"names":["window","_userMedia","FlashError","temp","Error","apply","arguments","name","stack","message","WebcamError","IntermediateInheritor","prototype","Webcam","version","protocol","location","match","loaded","live","userMedia","iOS","test","navigator","userAgent","MSStream","params","width","height","dest_width","dest_height","image_format","jpeg_quality","enable_flash","force_flash","flip_horiz","fps","upload_name","constraints","swfURL","flashNotDetectedText","noInterfaceFoundText","unfreeze_snap","iosPlaceholderText","user_callback","user_canvas","errors","hooks","init","self","mediaDevices","getUserMedia","mozGetUserMedia","webkitGetUserMedia","c","Promise","y","n","call","URL","webkitURL","mozURL","msURL","parseInt","RegExp","$1","addEventListener","reset","exifOrientation","binFile","dataView","DataView","getUint8","console","log","offset","marker","byteLength","str","String","fromCharCode","bigEnd","getUint16","firstIFDOffset","getUint32","dataStart","entries","i","entryOffset","valueType","numValues","value","fixOrientation","origObjURL","orientation","targetImg","img","Image","canvas","document","createElement","ctx","getContext","transform","drawImage","src","toDataURL","attach","elem","getElementById","querySelector","dispatch","container","innerHTML","peg","appendChild","offsetWidth","offsetHeight","scaleX","scaleY","video","setAttribute","style","overflow","webkitTransformOrigin","mozTransformOrigin","msTransformOrigin","oTransformOrigin","transformOrigin","webkitTransform","mozTransform","msTransform","oTransform","mandatory","minWidth","minHeight","then","stream","onloadedmetadata","flip","srcObject","createObjectURL","catch","err","detectFlash","setTimeout","div","id","className","textAlign","display","verticalAlign","backgroundRepeat","backgroundSize","backgroundPosition","span","input","event","target","files","length","type","indexOf","objURL","image","ratio","Math","min","sw","sh","sx","sy","dataURL","backgroundImage","fileReader","FileReader","e","result","http","XMLHttpRequest","open","responseType","onload","status","readAsArrayBuffer","response","send","snap","focus","click","getSWFHTML","crop_width","crop_height","scaled_crop_width","floor","scaled_crop_height","scrollLeft","scrollTop","preview_active","unfreeze","unflip","getVideoTracks","tracks","stop","movie","getMovie","_releaseCamera","set","key","on","callback","replace","toLowerCase","push","off","idx","splice","args","Array","slice","len","hook","toString","alert","setSWFLocation","nav","hasFlash","plugins","desc","description","mimeTypes","enabledPlugin","ActiveXObject","ax","ver","GetVariable","html","base_url","scpts","getElementsByTagName","getAttribute","localStorage","getItem","new_user","setItem","flashvars","escape","_snap","freeze","final_width","final_height","preview_canvas","preview_context","position","left","top","insertBefore","removeChild","sty","filter","msFilter","savePreview","context","user_context","translate","scale","func","crop_canvas","crop_context","iFunc","removeEventListener","removeAttribute","raw_data","configure","panel","_configure","flashNotify","msg","b64ToUint6","nChr","base64DecToArr","sBase64","nBlocksSize","sB64Enc","nInLen","nOutLen","ceil","taBytes","Uint8Array","nMod3","nMod4","nUint24","nOutIdx","nInIdx","charCodeAt","upload","image_data_uri","target_url","form_elem_name","image_fmt","raw_image_data","lengthComputable","progress","total","responseText","statusText","blob","Blob","form","FormData","append","define","amd","module","exports"],"mappings":"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","sourcesContent":["// WebcamJS v1.0.26\n// Webcam library for capturing JPEG/PNG images in JavaScript\n// Attempts getUserMedia, falls back to Flash\n// Author: Joseph Huckaby: http://github.com/jhuckaby\n// Based on JPEGCam: http://code.google.com/p/jpegcam/\n// Copyright (c) 2012 - 2019 Joseph Huckaby\n// Licensed under the MIT License\n\n(function(window) {\nvar _userMedia;\n\n// declare error types\n\n// inheritance pattern here:\n// https://stackoverflow.com/questions/783818/how-do-i-create-a-custom-error-in-javascript\nfunction FlashError() {\n\tvar temp = Error.apply(this, arguments);\n\ttemp.name = this.name = \"FlashError\";\n\tthis.stack = temp.stack;\n\tthis.message = temp.message;\n}\n\nfunction WebcamError() {\n\tvar temp = Error.apply(this, arguments);\n\ttemp.name = this.name = \"WebcamError\";\n\tthis.stack = temp.stack;\n\tthis.message = temp.message;\n}\n\nvar IntermediateInheritor = function() {};\nIntermediateInheritor.prototype = Error.prototype;\n\nFlashError.prototype = new IntermediateInheritor();\nWebcamError.prototype = new IntermediateInheritor();\n\nvar Webcam = {\n\tversion: '1.0.26',\n\t\n\t// globals\n\tprotocol: location.protocol.match(/https/i) ? 'https' : 'http',\n\tloaded: false,   // true when webcam movie finishes loading\n\tlive: false,     // true when webcam is initialized and ready to snap\n\tuserMedia: true, // true when getUserMedia is supported natively\n\n\tiOS: /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream,\n\n\tparams: {\n\t\twidth: 0,\n\t\theight: 0,\n\t\tdest_width: 0,         // size of captured image\n\t\tdest_height: 0,        // these default to width/height\n\t\timage_format: 'jpeg',  // image format (may be jpeg or png)\n\t\tjpeg_quality: 90,      // jpeg image quality from 0 (worst) to 100 (best)\n\t\tenable_flash: true,    // enable flash fallback,\n\t\tforce_flash: false,    // force flash mode,\n\t\tflip_horiz: false,     // flip image horiz (mirror mode)\n\t\tfps: 30,               // camera frames per second\n\t\tupload_name: 'webcam', // name of file in upload post data\n\t\tconstraints: null,     // custom user media constraints,\n\t\tswfURL: '',            // URI to webcam.swf movie (defaults to the js location)\n\t\tflashNotDetectedText: 'ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).',\n\t\tnoInterfaceFoundText: 'No supported webcam interface found.',\n\t\tunfreeze_snap: true,    // Whether to unfreeze the camera after snap (defaults to true)\n\t\tiosPlaceholderText: 'Click here to open camera.',\n\t\tuser_callback: null,    // callback function for snapshot (used if no user_callback parameter given to snap function)\n\t\tuser_canvas: null       // user provided canvas for snapshot (used if no user_canvas parameter given to snap function)\n\t},\n\n\terrors: {\n\t\tFlashError: FlashError,\n\t\tWebcamError: WebcamError\n\t},\n\t\n\thooks: {}, // callback hook functions\n\t\n\tinit: function() {\n\t\t// initialize, check for getUserMedia support\n\t\tvar self = this;\n\t\t\n\t\t// Setup getUserMedia, with polyfill for older browsers\n\t\t// Adapted from: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n\t\tthis.mediaDevices = (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) ? \n\t\t\tnavigator.mediaDevices : ((navigator.mozGetUserMedia || navigator.webkitGetUserMedia) ? {\n\t\t\t\tgetUserMedia: function(c) {\n\t\t\t\t\treturn new Promise(function(y, n) {\n\t\t\t\t\t\t(navigator.mozGetUserMedia ||\n\t\t\t\t\t\tnavigator.webkitGetUserMedia).call(navigator, c, y, n);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t} : null);\n\t\t\n\t\twindow.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\t\tthis.userMedia = this.userMedia && !!this.mediaDevices && !!window.URL;\n\t\t\n\t\t// Older versions of firefox (< 21) apparently claim support but user media does not actually work\n\t\tif (navigator.userAgent.match(/Firefox\\D+(\\d+)/)) {\n\t\t\tif (parseInt(RegExp.$1, 10) < 21) this.userMedia = null;\n\t\t}\n\t\t\n\t\t// Make sure media stream is closed when navigating away from page\n\t\tif (this.userMedia) {\n\t\t\twindow.addEventListener( 'beforeunload', function(event) {\n\t\t\t\tself.reset();\n\t\t\t} );\n\t\t}\n\t},\n\t\n\texifOrientation: function(binFile) {\n\t\t// extract orientation information from the image provided by iOS\n\t\t// algorithm based on exif-js\n\t\tvar dataView = new DataView(binFile);\n\t\tif ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n\t\t\tconsole.log('Not a valid JPEG file');\n\t\t\treturn 0;\n\t\t}\n\t\tvar offset = 2;\n\t\tvar marker = null;\n\t\twhile (offset < binFile.byteLength) {\n\t\t\t// find 0xFFE1 (225 marker)\n\t\t\tif (dataView.getUint8(offset) != 0xFF) {\n\t\t\t\tconsole.log('Not a valid marker at offset ' + offset + ', found: ' + dataView.getUint8(offset));\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tmarker = dataView.getUint8(offset + 1);\n\t\t\tif (marker == 225) {\n\t\t\t\toffset += 4;\n\t\t\t\tvar str = \"\";\n\t\t\t\tfor (n = 0; n < 4; n++) {\n\t\t\t\t\tstr += String.fromCharCode(dataView.getUint8(offset+n));\n\t\t\t\t}\n\t\t\t\tif (str != 'Exif') {\n\t\t\t\t\tconsole.log('Not valid EXIF data found');\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\toffset += 6; // tiffOffset\n\t\t\t\tvar bigEnd = null;\n\n\t\t\t\t// test for TIFF validity and endianness\n\t\t\t\tif (dataView.getUint16(offset) == 0x4949) {\n\t\t\t\t\tbigEnd = false;\n\t\t\t\t} else if (dataView.getUint16(offset) == 0x4D4D) {\n\t\t\t\t\tbigEnd = true;\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"Not valid TIFF data! (no 0x4949 or 0x4D4D)\");\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\tif (dataView.getUint16(offset+2, !bigEnd) != 0x002A) {\n\t\t\t\t\tconsole.log(\"Not valid TIFF data! (no 0x002A)\");\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\tvar firstIFDOffset = dataView.getUint32(offset+4, !bigEnd);\n\t\t\t\tif (firstIFDOffset < 0x00000008) {\n\t\t\t\t\tconsole.log(\"Not valid TIFF data! (First offset less than 8)\", dataView.getUint32(offset+4, !bigEnd));\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\t// extract orientation data\n\t\t\t\tvar dataStart = offset + firstIFDOffset;\n\t\t\t\tvar entries = dataView.getUint16(dataStart, !bigEnd);\n\t\t\t\tfor (var i=0; i<entries; i++) {\n\t\t\t\t\tvar entryOffset = dataStart + i*12 + 2;\n\t\t\t\t\tif (dataView.getUint16(entryOffset, !bigEnd) == 0x0112) {\n\t\t\t\t\t\tvar valueType = dataView.getUint16(entryOffset+2, !bigEnd);\n\t\t\t\t\t\tvar numValues = dataView.getUint32(entryOffset+4, !bigEnd);\n\t\t\t\t\t\tif (valueType != 3 && numValues != 1) {\n\t\t\t\t\t\t\tconsole.log('Invalid EXIF orientation value type ('+valueType+') or count ('+numValues+')');\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar value = dataView.getUint16(entryOffset + 8, !bigEnd);\n\t\t\t\t\t\tif (value < 1 || value > 8) {\n\t\t\t\t\t\t\tconsole.log('Invalid EXIF orientation value ('+value+')');\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toffset += 2+dataView.getUint16(offset+2);\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t},\n\t\n\tfixOrientation: function(origObjURL, orientation, targetImg) {\n\t\t// fix image orientation based on exif orientation data\n\t\t// exif orientation information\n\t\t//    http://www.impulseadventure.com/photo/exif-orientation.html\n\t\t//    link source wikipedia (https://en.wikipedia.org/wiki/Exif#cite_note-20)\n\t\tvar img = new Image();\n\t\timg.addEventListener('load', function(event) {\n\t\t\tvar canvas = document.createElement('canvas');\n\t\t\tvar ctx = canvas.getContext('2d');\n\t\t\t\n\t\t\t// switch width height if orientation needed\n\t\t\tif (orientation < 5) {\n\t\t\t\tcanvas.width = img.width;\n\t\t\t\tcanvas.height = img.height;\n\t\t\t} else {\n\t\t\t\tcanvas.width = img.height;\n\t\t\t\tcanvas.height = img.width;\n\t\t\t}\n\n\t\t\t// transform (rotate) image - see link at beginning this method\n\t\t\tswitch (orientation) {\n\t\t\t\tcase 2: ctx.transform(-1, 0, 0, 1, img.width, 0); break;\n\t\t\t\tcase 3: ctx.transform(-1, 0, 0, -1, img.width, img.height); break;\n\t\t\t\tcase 4: ctx.transform(1, 0, 0, -1, 0, img.height); break;\n\t\t\t\tcase 5: ctx.transform(0, 1, 1, 0, 0, 0); break;\n\t\t\t\tcase 6: ctx.transform(0, 1, -1, 0, img.height , 0); break;\n\t\t\t\tcase 7: ctx.transform(0, -1, -1, 0, img.height, img.width); break;\n\t\t\t\tcase 8: ctx.transform(0, -1, 1, 0, 0, img.width); break;\n\t\t\t}\n\n\t\t\tctx.drawImage(img, 0, 0);\n\t\t\t// pass rotated image data to the target image container\n\t\t\ttargetImg.src = canvas.toDataURL();\n\t\t}, false);\n\t\t// start transformation by load event\n\t\timg.src = origObjURL;\n\t},\n\t\n\tattach: function(elem) {\n\t\t// create webcam preview and attach to DOM element\n\t\t// pass in actual DOM reference, ID, or CSS selector\n\t\tif (typeof(elem) == 'string') {\n\t\t\telem = document.getElementById(elem) || document.querySelector(elem);\n\t\t}\n\t\tif (!elem) {\n\t\t\treturn this.dispatch('error', new WebcamError(\"Could not locate DOM element to attach to.\"));\n\t\t}\n\t\tthis.container = elem;\n\t\telem.innerHTML = ''; // start with empty element\n\t\t\n\t\t// insert \"peg\" so we can insert our preview canvas adjacent to it later on\n\t\tvar peg = document.createElement('div');\n\t\telem.appendChild( peg );\n\t\tthis.peg = peg;\n\t\t\n\t\t// set width/height if not already set\n\t\tif (!this.params.width) this.params.width = elem.offsetWidth;\n\t\tif (!this.params.height) this.params.height = elem.offsetHeight;\n\t\t\n\t\t// make sure we have a nonzero width and height at this point\n\t\tif (!this.params.width || !this.params.height) {\n\t\t\treturn this.dispatch('error', new WebcamError(\"No width and/or height for webcam.  Please call set() first, or attach to a visible element.\"));\n\t\t}\n\t\t\n\t\t// set defaults for dest_width / dest_height if not set\n\t\tif (!this.params.dest_width) this.params.dest_width = this.params.width;\n\t\tif (!this.params.dest_height) this.params.dest_height = this.params.height;\n\t\t\n\t\tthis.userMedia = _userMedia === undefined ? this.userMedia : _userMedia;\n\t\t// if force_flash is set, disable userMedia\n\t\tif (this.params.force_flash) {\n\t\t\t_userMedia = this.userMedia;\n\t\t\tthis.userMedia = null;\n\t\t}\n\t\t\n\t\t// check for default fps\n\t\tif (typeof this.params.fps !== \"number\") this.params.fps = 30;\n\n\t\t// adjust scale if dest_width or dest_height is different\n\t\tvar scaleX = this.params.width / this.params.dest_width;\n\t\tvar scaleY = this.params.height / this.params.dest_height;\n\t\t\n\t\tif (this.userMedia) {\n\t\t\t// setup webcam video container\n\t\t\tvar video = document.createElement('video');\n\t\t\tvideo.setAttribute('autoplay', 'autoplay');\n\t\t\tvideo.setAttribute('playsinline', 'playsinline');\n\t\t\tvideo.style.width = '' + this.params.dest_width + 'px';\n\t\t\tvideo.style.height = '' + this.params.dest_height + 'px';\n\t\t\t\n\t\t\tif ((scaleX != 1.0) || (scaleY != 1.0)) {\n\t\t\t\telem.style.overflow = 'hidden';\n\t\t\t\tvideo.style.webkitTransformOrigin = '0px 0px';\n\t\t\t\tvideo.style.mozTransformOrigin = '0px 0px';\n\t\t\t\tvideo.style.msTransformOrigin = '0px 0px';\n\t\t\t\tvideo.style.oTransformOrigin = '0px 0px';\n\t\t\t\tvideo.style.transformOrigin = '0px 0px';\n\t\t\t\tvideo.style.webkitTransform = 'scaleX('+scaleX+') scaleY('+scaleY+')';\n\t\t\t\tvideo.style.mozTransform = 'scaleX('+scaleX+') scaleY('+scaleY+')';\n\t\t\t\tvideo.style.msTransform = 'scaleX('+scaleX+') scaleY('+scaleY+')';\n\t\t\t\tvideo.style.oTransform = 'scaleX('+scaleX+') scaleY('+scaleY+')';\n\t\t\t\tvideo.style.transform = 'scaleX('+scaleX+') scaleY('+scaleY+')';\n\t\t\t}\n\t\t\t\n\t\t\t// add video element to dom\n\t\t\telem.appendChild( video );\n\t\t\tthis.video = video;\n\t\t\t\n\t\t\t// ask user for access to their camera\n\t\t\tvar self = this;\n\t\t\tthis.mediaDevices.getUserMedia({\n\t\t\t\t\"audio\": false,\n\t\t\t\t\"video\": this.params.constraints || {\n\t\t\t\t\tmandatory: {\n\t\t\t\t\t\tminWidth: this.params.dest_width,\n\t\t\t\t\t\tminHeight: this.params.dest_height\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then( function(stream) {\n\t\t\t\t// got access, attach stream to video\n\t\t\t\tvideo.onloadedmetadata = function(e) {\n\t\t\t\t\tself.stream = stream;\n\t\t\t\t\tself.loaded = true;\n\t\t\t\t\tself.live = true;\n\t\t\t\t\tself.dispatch('load');\n\t\t\t\t\tself.dispatch('live');\n\t\t\t\t\tself.flip();\n\t\t\t\t};\n\t\t\t\t// as window.URL.createObjectURL() is deprecated, adding a check so that it works in Safari.\n\t\t\t\t// older browsers may not have srcObject\n\t\t\t\tif (\"srcObject\" in video) {\n\t\t\t\t  \tvideo.srcObject = stream;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t  \t// using URL.createObjectURL() as fallback for old browsers\n\t\t\t\t  \tvideo.src = window.URL.createObjectURL(stream);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch( function(err) {\n\t\t\t\t// JH 2016-07-31 Instead of dispatching error, now falling back to Flash if userMedia fails (thx @john2014)\n\t\t\t\t// JH 2016-08-07 But only if flash is actually installed -- if not, dispatch error here and now.\n\t\t\t\tif (self.params.enable_flash && self.detectFlash()) {\n\t\t\t\t\tsetTimeout( function() { self.params.force_flash = 1; self.attach(elem); }, 1 );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tself.dispatch('error', err);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (this.iOS) {\n\t\t\t// prepare HTML elements\n\t\t\tvar div = document.createElement('div');\n\t\t\tdiv.id = this.container.id+'-ios_div';\n\t\t\tdiv.className = 'webcamjs-ios-placeholder';\n\t\t\tdiv.style.width = '' + this.params.width + 'px';\n\t\t\tdiv.style.height = '' + this.params.height + 'px';\n\t\t\tdiv.style.textAlign = 'center';\n\t\t\tdiv.style.display = 'table-cell';\n\t\t\tdiv.style.verticalAlign = 'middle';\n\t\t\tdiv.style.backgroundRepeat = 'no-repeat';\n\t\t\tdiv.style.backgroundSize = 'contain';\n\t\t\tdiv.style.backgroundPosition = 'center';\n\t\t\tvar span = document.createElement('span');\n\t\t\tspan.className = 'webcamjs-ios-text';\n\t\t\tspan.innerHTML = this.params.iosPlaceholderText;\n\t\t\tdiv.appendChild(span);\n\t\t\tvar img = document.createElement('img');\n\t\t\timg.id = this.container.id+'-ios_img';\n\t\t\timg.style.width = '' + this.params.dest_width + 'px';\n\t\t\timg.style.height = '' + this.params.dest_height + 'px';\n\t\t\timg.style.display = 'none';\n\t\t\tdiv.appendChild(img);\n\t\t\tvar input = document.createElement('input');\n\t\t\tinput.id = this.container.id+'-ios_input';\n\t\t\tinput.setAttribute('type', 'file');\n\t\t\tinput.setAttribute('accept', 'image/*');\n\t\t\tinput.setAttribute('capture', 'camera');\n\t\t\t\n\t\t\tvar self = this;\n\t\t\tvar params = this.params;\n\t\t\t// add input listener to load the selected image\n\t\t\tinput.addEventListener('change', function(event) {\n\t\t\t\tif (event.target.files.length > 0 && event.target.files[0].type.indexOf('image/') == 0) {\n\t\t\t\t\tvar objURL = URL.createObjectURL(event.target.files[0]);\n\n\t\t\t\t\t// load image with auto scale and crop\n\t\t\t\t\tvar image = new Image();\n\t\t\t\t\timage.addEventListener('load', function(event) {\n\t\t\t\t\t\tvar canvas = document.createElement('canvas');\n\t\t\t\t\t\tcanvas.width = params.dest_width;\n\t\t\t\t\t\tcanvas.height = params.dest_height;\n\t\t\t\t\t\tvar ctx = canvas.getContext('2d');\n\n\t\t\t\t\t\t// crop and scale image for final size\n\t\t\t\t\t\tratio = Math.min(image.width / params.dest_width, image.height / params.dest_height);\n\t\t\t\t\t\tvar sw = params.dest_width * ratio;\n\t\t\t\t\t\tvar sh = params.dest_height * ratio;\n\t\t\t\t\t\tvar sx = (image.width - sw) / 2;\n\t\t\t\t\t\tvar sy = (image.height - sh) / 2;\n\t\t\t\t\t\tctx.drawImage(image, sx, sy, sw, sh, 0, 0, params.dest_width, params.dest_height);\n\n\t\t\t\t\t\tvar dataURL = canvas.toDataURL();\n\t\t\t\t\t\timg.src = dataURL;\n\t\t\t\t\t\tdiv.style.backgroundImage = \"url('\"+dataURL+\"')\";\n\t\t\t\t\t}, false);\n\t\t\t\t\t\n\t\t\t\t\t// read EXIF data\n\t\t\t\t\tvar fileReader = new FileReader();\n\t\t\t\t\tfileReader.addEventListener('load', function(e) {\n\t\t\t\t\t\tvar orientation = self.exifOrientation(e.target.result);\n\t\t\t\t\t\tif (orientation > 1) {\n\t\t\t\t\t\t\t// image need to rotate (see comments on fixOrientation method for more information)\n\t\t\t\t\t\t\t// transform image and load to image object\n\t\t\t\t\t\t\tself.fixOrientation(objURL, orientation, image);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// load image data to image object\n\t\t\t\t\t\t\timage.src = objURL;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, false);\n\t\t\t\t\t\n\t\t\t\t\t// Convert image data to blob format\n\t\t\t\t\tvar http = new XMLHttpRequest();\n\t\t\t\t\thttp.open(\"GET\", objURL, true);\n\t\t\t\t\thttp.responseType = \"blob\";\n\t\t\t\t\thttp.onload = function(e) {\n\t\t\t\t\t\tif (this.status == 200 || this.status === 0) {\n\t\t\t\t\t\t\tfileReader.readAsArrayBuffer(this.response);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\thttp.send();\n\n\t\t\t\t}\n\t\t\t}, false);\n\t\t\tinput.style.display = 'none';\n\t\t\telem.appendChild(input);\n\t\t\t// make div clickable for open camera interface\n\t\t\tdiv.addEventListener('click', function(event) {\n\t\t\t\tif (params.user_callback) {\n\t\t\t\t\t// global user_callback defined - create the snapshot\n\t\t\t\t\tself.snap(params.user_callback, params.user_canvas);\n\t\t\t\t} else {\n\t\t\t\t\t// no global callback definied for snapshot, load image and wait for external snap method call\n\t\t\t\t\tinput.style.display = 'block';\n\t\t\t\t\tinput.focus();\n\t\t\t\t\tinput.click();\n\t\t\t\t\tinput.style.display = 'none';\n\t\t\t\t}\n\t\t\t}, false);\n\t\t\telem.appendChild(div);\n\t\t\tthis.loaded = true;\n\t\t\tthis.live = true;\n\t\t}\n\t\telse if (this.params.enable_flash && this.detectFlash()) {\n\t\t\t// flash fallback\n\t\t\twindow.Webcam = Webcam; // needed for flash-to-js interface\n\t\t\tvar div = document.createElement('div');\n\t\t\tdiv.innerHTML = this.getSWFHTML();\n\t\t\telem.appendChild( div );\n\t\t}\n\t\telse {\n\t\t\tthis.dispatch('error', new WebcamError( this.params.noInterfaceFoundText ));\n\t\t}\n\t\t\n\t\t// setup final crop for live preview\n\t\tif (this.params.crop_width && this.params.crop_height) {\n\t\t\tvar scaled_crop_width = Math.floor( this.params.crop_width * scaleX );\n\t\t\tvar scaled_crop_height = Math.floor( this.params.crop_height * scaleY );\n\t\t\t\n\t\t\telem.style.width = '' + scaled_crop_width + 'px';\n\t\t\telem.style.height = '' + scaled_crop_height + 'px';\n\t\t\telem.style.overflow = 'hidden';\n\t\t\t\n\t\t\telem.scrollLeft = Math.floor( (this.params.width / 2) - (scaled_crop_width / 2) );\n\t\t\telem.scrollTop = Math.floor( (this.params.height / 2) - (scaled_crop_height / 2) );\n\t\t}\n\t\telse {\n\t\t\t// no crop, set size to desired\n\t\t\telem.style.width = '' + this.params.width + 'px';\n\t\t\telem.style.height = '' + this.params.height + 'px';\n\t\t}\n\t},\n\t\n\treset: function() {\n\t\t// shutdown camera, reset to potentially attach again\n\t\tif (this.preview_active) this.unfreeze();\n\t\t\n\t\t// attempt to fix issue #64\n\t\tthis.unflip();\n\t\t\n\t\tif (this.userMedia) {\n\t\t\tif (this.stream) {\n\t\t\t\tif (this.stream.getVideoTracks) {\n\t\t\t\t\t// get video track to call stop on it\n\t\t\t\t\tvar tracks = this.stream.getVideoTracks();\n\t\t\t\t\tif (tracks && tracks[0] && tracks[0].stop) tracks[0].stop();\n\t\t\t\t}\n\t\t\t\telse if (this.stream.stop) {\n\t\t\t\t\t// deprecated, may be removed in future\n\t\t\t\t\tthis.stream.stop();\n\t\t\t\t}\n\t\t\t}\n\t\t\tdelete this.stream;\n\t\t\tdelete this.video;\n\t\t}\n\n\t\tif ((this.userMedia !== true) && this.loaded && !this.iOS) {\n\t\t\t// call for turn off camera in flash\n\t\t\tvar movie = this.getMovie();\n\t\t\tif (movie && movie._releaseCamera) movie._releaseCamera();\n\t\t}\n\n\t\tif (this.container) {\n\t\t\tthis.container.innerHTML = '';\n\t\t\tdelete this.container;\n\t\t}\n\t\n\t\tthis.loaded = false;\n\t\tthis.live = false;\n\t},\n\t\n\tset: function() {\n\t\t// set one or more params\n\t\t// variable argument list: 1 param = hash, 2 params = key, value\n\t\tif (arguments.length == 1) {\n\t\t\tfor (var key in arguments[0]) {\n\t\t\t\tthis.params[key] = arguments[0][key];\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.params[ arguments[0] ] = arguments[1];\n\t\t}\n\t},\n\t\n\ton: function(name, callback) {\n\t\t// set callback hook\n\t\tname = name.replace(/^on/i, '').toLowerCase();\n\t\tif (!this.hooks[name]) this.hooks[name] = [];\n\t\tthis.hooks[name].push( callback );\n\t},\n\t\n\toff: function(name, callback) {\n\t\t// remove callback hook\n\t\tname = name.replace(/^on/i, '').toLowerCase();\n\t\tif (this.hooks[name]) {\n\t\t\tif (callback) {\n\t\t\t\t// remove one selected callback from list\n\t\t\t\tvar idx = this.hooks[name].indexOf(callback);\n\t\t\t\tif (idx > -1) this.hooks[name].splice(idx, 1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// no callback specified, so clear all\n\t\t\t\tthis.hooks[name] = [];\n\t\t\t}\n\t\t}\n\t},\n\t\n\tdispatch: function() {\n\t\t// fire hook callback, passing optional value to it\n\t\tvar name = arguments[0].replace(/^on/i, '').toLowerCase();\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\t\n\t\tif (this.hooks[name] && this.hooks[name].length) {\n\t\t\tfor (var idx = 0, len = this.hooks[name].length; idx < len; idx++) {\n\t\t\t\tvar hook = this.hooks[name][idx];\n\t\t\t\t\n\t\t\t\tif (typeof(hook) == 'function') {\n\t\t\t\t\t// callback is function reference, call directly\n\t\t\t\t\thook.apply(this, args);\n\t\t\t\t}\n\t\t\t\telse if ((typeof(hook) == 'object') && (hook.length == 2)) {\n\t\t\t\t\t// callback is PHP-style object instance method\n\t\t\t\t\thook[0][hook[1]].apply(hook[0], args);\n\t\t\t\t}\n\t\t\t\telse if (window[hook]) {\n\t\t\t\t\t// callback is global function name\n\t\t\t\t\twindow[ hook ].apply(window, args);\n\t\t\t\t}\n\t\t\t} // loop\n\t\t\treturn true;\n\t\t}\n\t\telse if (name == 'error') {\n\t\t\tvar message;\n\t\t\tif ((args[0] instanceof FlashError) || (args[0] instanceof WebcamError)) {\n\t\t\t\tmessage = args[0].message;\n\t\t\t} else {\n\t\t\t\tmessage = \"Could not access webcam: \" + args[0].name + \": \" + \n\t\t\t\t\targs[0].message + \" \" + args[0].toString();\n\t\t\t}\n\n\t\t\t// default error handler if no custom one specified\n\t\t\talert(\"Webcam.js Error: \" + message);\n\t\t}\n\t\t\n\t\treturn false; // no hook defined\n\t},\n\n\tsetSWFLocation: function(value) {\n\t\t// for backward compatibility.\n\t\tthis.set('swfURL', value);\n\t},\n\t\n\tdetectFlash: function() {\n\t\t// return true if browser supports flash, false otherwise\n\t\t// Code snippet borrowed from: https://github.com/swfobject/swfobject\n\t\tvar SHOCKWAVE_FLASH = \"Shockwave Flash\",\n\t\t\tSHOCKWAVE_FLASH_AX = \"ShockwaveFlash.ShockwaveFlash\",\n        \tFLASH_MIME_TYPE = \"application/x-shockwave-flash\",\n        \twin = window,\n        \tnav = navigator,\n        \thasFlash = false;\n        \n        if (typeof nav.plugins !== \"undefined\" && typeof nav.plugins[SHOCKWAVE_FLASH] === \"object\") {\n        \tvar desc = nav.plugins[SHOCKWAVE_FLASH].description;\n        \tif (desc && (typeof nav.mimeTypes !== \"undefined\" && nav.mimeTypes[FLASH_MIME_TYPE] && nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)) {\n        \t\thasFlash = true;\n        \t}\n        }\n        else if (typeof win.ActiveXObject !== \"undefined\") {\n        \ttry {\n        \t\tvar ax = new ActiveXObject(SHOCKWAVE_FLASH_AX);\n        \t\tif (ax) {\n        \t\t\tvar ver = ax.GetVariable(\"$version\");\n        \t\t\tif (ver) hasFlash = true;\n        \t\t}\n        \t}\n        \tcatch (e) {;}\n        }\n        \n        return hasFlash;\n\t},\n\t\n\tgetSWFHTML: function() {\n\t\t// Return HTML for embedding flash based webcam capture movie\t\t\n\t\tvar html = '',\n\t\t\tswfURL = this.params.swfURL;\n\t\t\n\t\t// make sure we aren't running locally (flash doesn't work)\n\t\tif (location.protocol.match(/file/)) {\n\t\t\tthis.dispatch('error', new FlashError(\"Flash does not work from local disk.  Please run from a web server.\"));\n\t\t\treturn '<h3 style=\"color:red\">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>';\n\t\t}\n\t\t\n\t\t// make sure we have flash\n\t\tif (!this.detectFlash()) {\n\t\t\tthis.dispatch('error', new FlashError(\"Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again.\"));\n\t\t\treturn '<h3 style=\"color:red\">' + this.params.flashNotDetectedText + '</h3>';\n\t\t}\n\t\t\n\t\t// set default swfURL if not explicitly set\n\t\tif (!swfURL) {\n\t\t\t// find our script tag, and use that base URL\n\t\t\tvar base_url = '';\n\t\t\tvar scpts = document.getElementsByTagName('script');\n\t\t\tfor (var idx = 0, len = scpts.length; idx < len; idx++) {\n\t\t\t\tvar src = scpts[idx].getAttribute('src');\n\t\t\t\tif (src && src.match(/\\/webcam(\\.min)?\\.js/)) {\n\t\t\t\t\tbase_url = src.replace(/\\/webcam(\\.min)?\\.js.*$/, '');\n\t\t\t\t\tidx = len;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (base_url) swfURL = base_url + '/webcam.swf';\n\t\t\telse swfURL = 'webcam.swf';\n\t\t}\n\t\t\n\t\t// if this is the user's first visit, set flashvar so flash privacy settings panel is shown first\n\t\tif (window.localStorage && !localStorage.getItem('visited')) {\n\t\t\tthis.params.new_user = 1;\n\t\t\tlocalStorage.setItem('visited', 1);\n\t\t}\n\t\t\n\t\t// construct flashvars string\n\t\tvar flashvars = '';\n\t\tfor (var key in this.params) {\n\t\t\tif (flashvars) flashvars += '&';\n\t\t\tflashvars += key + '=' + escape(this.params[key]);\n\t\t}\n\t\t\n\t\t// construct object/embed tag\n\t\thtml += '<object classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" type=\"application/x-shockwave-flash\" codebase=\"'+this.protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0\" width=\"'+this.params.width+'\" height=\"'+this.params.height+'\" id=\"webcam_movie_obj\" align=\"middle\"><param name=\"wmode\" value=\"opaque\" /><param name=\"allowScriptAccess\" value=\"always\" /><param name=\"allowFullScreen\" value=\"false\" /><param name=\"movie\" value=\"'+swfURL+'\" /><param name=\"loop\" value=\"false\" /><param name=\"menu\" value=\"false\" /><param name=\"quality\" value=\"best\" /><param name=\"bgcolor\" value=\"#ffffff\" /><param name=\"flashvars\" value=\"'+flashvars+'\"/><embed id=\"webcam_movie_embed\" src=\"'+swfURL+'\" wmode=\"opaque\" loop=\"false\" menu=\"false\" quality=\"best\" bgcolor=\"#ffffff\" width=\"'+this.params.width+'\" height=\"'+this.params.height+'\" name=\"webcam_movie_embed\" align=\"middle\" allowScriptAccess=\"always\" allowFullScreen=\"false\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\" flashvars=\"'+flashvars+'\"></embed></object>';\n\t\t\n\t\treturn html;\n\t},\n\t\n\tgetMovie: function() {\n\t\t// get reference to movie object/embed in DOM\n\t\tif (!this.loaded) return this.dispatch('error', new FlashError(\"Flash Movie is not loaded yet\"));\n\t\tvar movie = document.getElementById('webcam_movie_obj');\n\t\tif (!movie || !movie._snap) movie = document.getElementById('webcam_movie_embed');\n\t\tif (!movie) this.dispatch('error', new FlashError(\"Cannot locate Flash movie in DOM\"));\n\t\treturn movie;\n\t},\n\t\n\tfreeze: function() {\n\t\t// show preview, freeze camera\n\t\tvar self = this;\n\t\tvar params = this.params;\n\t\t\n\t\t// kill preview if already active\n\t\tif (this.preview_active) this.unfreeze();\n\t\t\n\t\t// determine scale factor\n\t\tvar scaleX = this.params.width / this.params.dest_width;\n\t\tvar scaleY = this.params.height / this.params.dest_height;\n\t\t\n\t\t// must unflip container as preview canvas will be pre-flipped\n\t\tthis.unflip();\n\t\t\n\t\t// calc final size of image\n\t\tvar final_width = params.crop_width || params.dest_width;\n\t\tvar final_height = params.crop_height || params.dest_height;\n\t\t\n\t\t// create canvas for holding preview\n\t\tvar preview_canvas = document.createElement('canvas');\n\t\tpreview_canvas.width = final_width;\n\t\tpreview_canvas.height = final_height;\n\t\tvar preview_context = preview_canvas.getContext('2d');\n\t\t\n\t\t// save for later use\n\t\tthis.preview_canvas = preview_canvas;\n\t\tthis.preview_context = preview_context;\n\t\t\n\t\t// scale for preview size\n\t\tif ((scaleX != 1.0) || (scaleY != 1.0)) {\n\t\t\tpreview_canvas.style.webkitTransformOrigin = '0px 0px';\n\t\t\tpreview_canvas.style.mozTransformOrigin = '0px 0px';\n\t\t\tpreview_canvas.style.msTransformOrigin = '0px 0px';\n\t\t\tpreview_canvas.style.oTransformOrigin = '0px 0px';\n\t\t\tpreview_canvas.style.transformOrigin = '0px 0px';\n\t\t\tpreview_canvas.style.webkitTransform = 'scaleX('+scaleX+') scaleY('+scaleY+')';\n\t\t\tpreview_canvas.style.mozTransform = 'scaleX('+scaleX+') scaleY('+scaleY+')';\n\t\t\tpreview_canvas.style.msTransform = 'scaleX('+scaleX+') scaleY('+scaleY+')';\n\t\t\tpreview_canvas.style.oTransform = 'scaleX('+scaleX+') scaleY('+scaleY+')';\n\t\t\tpreview_canvas.style.transform = 'scaleX('+scaleX+') scaleY('+scaleY+')';\n\t\t}\n\t\t\n\t\t// take snapshot, but fire our own callback\n\t\tthis.snap( function() {\n\t\t\t// add preview image to dom, adjust for crop\n\t\t\tpreview_canvas.style.position = 'relative';\n\t\t\tpreview_canvas.style.left = '' + self.container.scrollLeft + 'px';\n\t\t\tpreview_canvas.style.top = '' + self.container.scrollTop + 'px';\n\t\t\t\n\t\t\tself.container.insertBefore( preview_canvas, self.peg );\n\t\t\tself.container.style.overflow = 'hidden';\n\t\t\t\n\t\t\t// set flag for user capture (use preview)\n\t\t\tself.preview_active = true;\n\t\t\t\n\t\t}, preview_canvas );\n\t},\n\t\n\tunfreeze: function() {\n\t\t// cancel preview and resume live video feed\n\t\tif (this.preview_active) {\n\t\t\t// remove preview canvas\n\t\t\tthis.container.removeChild( this.preview_canvas );\n\t\t\tdelete this.preview_context;\n\t\t\tdelete this.preview_canvas;\n\t\t\t\n\t\t\t// unflag\n\t\t\tthis.preview_active = false;\n\t\t\t\n\t\t\t// re-flip if we unflipped before\n\t\t\tthis.flip();\n\t\t}\n\t},\n\t\n\tflip: function() {\n\t\t// flip container horiz (mirror mode) if desired\n\t\tif (this.params.flip_horiz) {\n\t\t\tvar sty = this.container.style;\n\t\t\tsty.webkitTransform = 'scaleX(-1)';\n\t\t\tsty.mozTransform = 'scaleX(-1)';\n\t\t\tsty.msTransform = 'scaleX(-1)';\n\t\t\tsty.oTransform = 'scaleX(-1)';\n\t\t\tsty.transform = 'scaleX(-1)';\n\t\t\tsty.filter = 'FlipH';\n\t\t\tsty.msFilter = 'FlipH';\n\t\t}\n\t},\n\t\n\tunflip: function() {\n\t\t// unflip container horiz (mirror mode) if desired\n\t\tif (this.params.flip_horiz) {\n\t\t\tvar sty = this.container.style;\n\t\t\tsty.webkitTransform = 'scaleX(1)';\n\t\t\tsty.mozTransform = 'scaleX(1)';\n\t\t\tsty.msTransform = 'scaleX(1)';\n\t\t\tsty.oTransform = 'scaleX(1)';\n\t\t\tsty.transform = 'scaleX(1)';\n\t\t\tsty.filter = '';\n\t\t\tsty.msFilter = '';\n\t\t}\n\t},\n\t\n\tsavePreview: function(user_callback, user_canvas) {\n\t\t// save preview freeze and fire user callback\n\t\tvar params = this.params;\n\t\tvar canvas = this.preview_canvas;\n\t\tvar context = this.preview_context;\n\t\t\n\t\t// render to user canvas if desired\n\t\tif (user_canvas) {\n\t\t\tvar user_context = user_canvas.getContext('2d');\n\t\t\tuser_context.drawImage( canvas, 0, 0 );\n\t\t}\n\t\t\n\t\t// fire user callback if desired\n\t\tuser_callback(\n\t\t\tuser_canvas ? null : canvas.toDataURL('image/' + params.image_format, params.jpeg_quality / 100 ),\n\t\t\tcanvas,\n\t\t\tcontext\n\t\t);\n\t\t\n\t\t// remove preview\n\t\tif (this.params.unfreeze_snap) this.unfreeze();\n\t},\n\t\n\tsnap: function(user_callback, user_canvas) {\n\t\t// use global callback and canvas if not defined as parameter\n\t\tif (!user_callback) user_callback = this.params.user_callback;\n\t\tif (!user_canvas) user_canvas = this.params.user_canvas;\n\t\t\n\t\t// take snapshot and return image data uri\n\t\tvar self = this;\n\t\tvar params = this.params;\n\t\t\n\t\tif (!this.loaded) return this.dispatch('error', new WebcamError(\"Webcam is not loaded yet\"));\n\t\t// if (!this.live) return this.dispatch('error', new WebcamError(\"Webcam is not live yet\"));\n\t\tif (!user_callback) return this.dispatch('error', new WebcamError(\"Please provide a callback function or canvas to snap()\"));\n\t\t\n\t\t// if we have an active preview freeze, use that\n\t\tif (this.preview_active) {\n\t\t\tthis.savePreview( user_callback, user_canvas );\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\t// create offscreen canvas element to hold pixels\n\t\tvar canvas = document.createElement('canvas');\n\t\tcanvas.width = this.params.dest_width;\n\t\tcanvas.height = this.params.dest_height;\n\t\tvar context = canvas.getContext('2d');\n\t\t\n\t\t// flip canvas horizontally if desired\n\t\tif (this.params.flip_horiz) {\n\t\t\tcontext.translate( params.dest_width, 0 );\n\t\t\tcontext.scale( -1, 1 );\n\t\t}\n\t\t\n\t\t// create inline function, called after image load (flash) or immediately (native)\n\t\tvar func = function() {\n\t\t\t// render image if needed (flash)\n\t\t\tif (this.src && this.width && this.height) {\n\t\t\t\tcontext.drawImage(this, 0, 0, params.dest_width, params.dest_height);\n\t\t\t}\n\t\t\t\n\t\t\t// crop if desired\n\t\t\tif (params.crop_width && params.crop_height) {\n\t\t\t\tvar crop_canvas = document.createElement('canvas');\n\t\t\t\tcrop_canvas.width = params.crop_width;\n\t\t\t\tcrop_canvas.height = params.crop_height;\n\t\t\t\tvar crop_context = crop_canvas.getContext('2d');\n\t\t\t\t\n\t\t\t\tcrop_context.drawImage( canvas, \n\t\t\t\t\tMath.floor( (params.dest_width / 2) - (params.crop_width / 2) ),\n\t\t\t\t\tMath.floor( (params.dest_height / 2) - (params.crop_height / 2) ),\n\t\t\t\t\tparams.crop_width,\n\t\t\t\t\tparams.crop_height,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\tparams.crop_width,\n\t\t\t\t\tparams.crop_height\n\t\t\t\t);\n\t\t\t\t\n\t\t\t\t// swap canvases\n\t\t\t\tcontext = crop_context;\n\t\t\t\tcanvas = crop_canvas;\n\t\t\t}\n\t\t\t\n\t\t\t// render to user canvas if desired\n\t\t\tif (user_canvas) {\n\t\t\t\tvar user_context = user_canvas.getContext('2d');\n\t\t\t\tuser_context.drawImage( canvas, 0, 0 );\n\t\t\t}\n\t\t\t\n\t\t\t// fire user callback if desired\n\t\t\tuser_callback(\n\t\t\t\tuser_canvas ? null : canvas.toDataURL('image/' + params.image_format, params.jpeg_quality / 100 ),\n\t\t\t\tcanvas,\n\t\t\t\tcontext\n\t\t\t);\n\t\t};\n\t\t\n\t\t// grab image frame from userMedia or flash movie\n\t\tif (this.userMedia) {\n\t\t\t// native implementation\n\t\t\tcontext.drawImage(this.video, 0, 0, this.params.dest_width, this.params.dest_height);\n\t\t\t\n\t\t\t// fire callback right away\n\t\t\tfunc();\n\t\t}\n\t\telse if (this.iOS) {\n\t\t\tvar div = document.getElementById(this.container.id+'-ios_div');\n\t\t\tvar img = document.getElementById(this.container.id+'-ios_img');\n\t\t\tvar input = document.getElementById(this.container.id+'-ios_input');\n\t\t\t// function for handle snapshot event (call user_callback and reset the interface)\n\t\t\tiFunc = function(event) {\n\t\t\t\tfunc.call(img);\n\t\t\t\timg.removeEventListener('load', iFunc);\n\t\t\t\tdiv.style.backgroundImage = 'none';\n\t\t\t\timg.removeAttribute('src');\n\t\t\t\tinput.value = null;\n\t\t\t};\n\t\t\tif (!input.value) {\n\t\t\t\t// No image selected yet, activate input field\n\t\t\t\timg.addEventListener('load', iFunc);\n\t\t\t\tinput.style.display = 'block';\n\t\t\t\tinput.focus();\n\t\t\t\tinput.click();\n\t\t\t\tinput.style.display = 'none';\n\t\t\t} else {\n\t\t\t\t// Image already selected\n\t\t\t\tiFunc(null);\n\t\t\t}\t\t\t\n\t\t}\n\t\telse {\n\t\t\t// flash fallback\n\t\t\tvar raw_data = this.getMovie()._snap();\n\t\t\t\n\t\t\t// render to image, fire callback when complete\n\t\t\tvar img = new Image();\n\t\t\timg.onload = func;\n\t\t\timg.src = 'data:image/'+this.params.image_format+';base64,' + raw_data;\n\t\t}\n\t\t\n\t\treturn null;\n\t},\n\t\n\tconfigure: function(panel) {\n\t\t// open flash configuration panel -- specify tab name:\n\t\t// \"camera\", \"privacy\", \"default\", \"localStorage\", \"microphone\", \"settingsManager\"\n\t\tif (!panel) panel = \"camera\";\n\t\tthis.getMovie()._configure(panel);\n\t},\n\t\n\tflashNotify: function(type, msg) {\n\t\t// receive notification from flash about event\n\t\tswitch (type) {\n\t\t\tcase 'flashLoadComplete':\n\t\t\t\t// movie loaded successfully\n\t\t\t\tthis.loaded = true;\n\t\t\t\tthis.dispatch('load');\n\t\t\t\tbreak;\n\t\t\t\n\t\t\tcase 'cameraLive':\n\t\t\t\t// camera is live and ready to snap\n\t\t\t\tthis.live = true;\n\t\t\t\tthis.dispatch('live');\n\t\t\t\tbreak;\n\n\t\t\tcase 'error':\n\t\t\t\t// Flash error\n\t\t\t\tthis.dispatch('error', new FlashError(msg));\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// catch-all event, just in case\n\t\t\t\t// console.log(\"webcam flash_notify: \" + type + \": \" + msg);\n\t\t\t\tbreak;\n\t\t}\n\t},\n\t\n\tb64ToUint6: function(nChr) {\n\t\t// convert base64 encoded character to 6-bit integer\n\t\t// from: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Base64_encoding_and_decoding\n\t\treturn nChr > 64 && nChr < 91 ? nChr - 65\n\t\t\t: nChr > 96 && nChr < 123 ? nChr - 71\n\t\t\t: nChr > 47 && nChr < 58 ? nChr + 4\n\t\t\t: nChr === 43 ? 62 : nChr === 47 ? 63 : 0;\n\t},\n\n\tbase64DecToArr: function(sBase64, nBlocksSize) {\n\t\t// convert base64 encoded string to Uintarray\n\t\t// from: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Base64_encoding_and_decoding\n\t\tvar sB64Enc = sBase64.replace(/[^A-Za-z0-9\\+\\/]/g, \"\"), nInLen = sB64Enc.length,\n\t\t\tnOutLen = nBlocksSize ? Math.ceil((nInLen * 3 + 1 >> 2) / nBlocksSize) * nBlocksSize : nInLen * 3 + 1 >> 2, \n\t\t\ttaBytes = new Uint8Array(nOutLen);\n\t\t\n\t\tfor (var nMod3, nMod4, nUint24 = 0, nOutIdx = 0, nInIdx = 0; nInIdx < nInLen; nInIdx++) {\n\t\t\tnMod4 = nInIdx & 3;\n\t\t\tnUint24 |= this.b64ToUint6(sB64Enc.charCodeAt(nInIdx)) << 18 - 6 * nMod4;\n\t\t\tif (nMod4 === 3 || nInLen - nInIdx === 1) {\n\t\t\t\tfor (nMod3 = 0; nMod3 < 3 && nOutIdx < nOutLen; nMod3++, nOutIdx++) {\n\t\t\t\t\ttaBytes[nOutIdx] = nUint24 >>> (16 >>> nMod3 & 24) & 255;\n\t\t\t\t}\n\t\t\t\tnUint24 = 0;\n\t\t\t}\n\t\t}\n\t\treturn taBytes;\n\t},\n\t\n\tupload: function(image_data_uri, target_url, callback) {\n\t\t// submit image data to server using binary AJAX\n\t\tvar form_elem_name = this.params.upload_name || 'webcam';\n\t\t\n\t\t// detect image format from within image_data_uri\n\t\tvar image_fmt = '';\n\t\tif (image_data_uri.match(/^data\\:image\\/(\\w+)/))\n\t\t\timage_fmt = RegExp.$1;\n\t\telse\n\t\t\tthrow \"Cannot locate image format in Data URI\";\n\t\t\n\t\t// extract raw base64 data from Data URI\n\t\tvar raw_image_data = image_data_uri.replace(/^data\\:image\\/\\w+\\;base64\\,/, '');\n\t\t\n\t\t// contruct use AJAX object\n\t\tvar http = new XMLHttpRequest();\n\t\thttp.open(\"POST\", target_url, true);\n\t\t\n\t\t// setup progress events\n\t\tif (http.upload && http.upload.addEventListener) {\n\t\t\thttp.upload.addEventListener( 'progress', function(e) {\n\t\t\t\tif (e.lengthComputable) {\n\t\t\t\t\tvar progress = e.loaded / e.total;\n\t\t\t\t\tWebcam.dispatch('uploadProgress', progress, e);\n\t\t\t\t}\n\t\t\t}, false );\n\t\t}\n\t\t\n\t\t// completion handler\n\t\tvar self = this;\n\t\thttp.onload = function() {\n\t\t\tif (callback) callback.apply( self, [http.status, http.responseText, http.statusText] );\n\t\t\tWebcam.dispatch('uploadComplete', http.status, http.responseText, http.statusText);\n\t\t};\n\t\t\n\t\t// create a blob and decode our base64 to binary\n\t\tvar blob = new Blob( [ this.base64DecToArr(raw_image_data) ], {type: 'image/'+image_fmt} );\n\t\t\n\t\t// stuff into a form, so servers can easily receive it as a standard file upload\n\t\tvar form = new FormData();\n\t\tform.append( form_elem_name, blob, form_elem_name+\".\"+image_fmt.replace(/e/, '') );\n\t\t\n\t\t// send data to server\n\t\thttp.send(form);\n\t}\n\t\n};\n\nWebcam.init();\n\nif (typeof define === 'function' && define.amd) {\n\tdefine( function() { return Webcam; } );\n} \nelse if (typeof module === 'object' && module.exports) {\n\tmodule.exports = Webcam;\n} \nelse {\n\twindow.Webcam = Webcam;\n}\n\n}(window));\n"],"file":"webcam.min.js"}