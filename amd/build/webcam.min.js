function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}(function(a){var d;function b(){var a=Error.apply(this,arguments);a.name=this.name="FlashError";this.stack=a.stack;this.message=a.message}function c(){var a=Error.apply(this,arguments);a.name=this.name="WebcamError";this.stack=a.stack;this.message=a.message}var e=function(){};e.prototype=Error.prototype;b.prototype=new e;c.prototype=new e;var f={version:"1.0.26",protocol:location.protocol.match(/https/i)?"https":"http",loaded:!1,live:!1,userMedia:!0,iOS:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!a.MSStream,params:{width:0,height:0,dest_width:0,dest_height:0,image_format:"jpeg",jpeg_quality:90,enable_flash:!0,force_flash:!1,flip_horiz:!1,fps:30,upload_name:"webcam",constraints:null,swfURL:"",flashNotDetectedText:"ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).",noInterfaceFoundText:"No supported webcam interface found.",unfreeze_snap:!0,iosPlaceholderText:"Click here to open camera.",user_callback:null,user_canvas:null},errors:{FlashError:b,WebcamError:c},hooks:{},init:function init(){var b=this;this.mediaDevices=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices:navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function getUserMedia(a){return new Promise(function(b,c){(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,a,b,c)})}}:null;a.URL=a.URL||a.webkitURL||a.mozURL||a.msURL;this.userMedia=this.userMedia&&!!this.mediaDevices&&!!a.URL;if(navigator.userAgent.match(/Firefox\D+(\d+)/)){if(21>parseInt(RegExp.$1,10))this.userMedia=null}if(this.userMedia){a.addEventListener("beforeunload",function(){b.reset()})}},exifOrientation:function exifOrientation(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1)){console.log("Not a valid JPEG file");return 0}var c=2,d=null;while(c<a.byteLength){if(255!=b.getUint8(c)){console.log("Not a valid marker at offset "+c+", found: "+b.getUint8(c));return 0}d=b.getUint8(c+1);if(225==d){c+=4;var e="";for(n=0;4>n;n++){e+=String.fromCharCode(b.getUint8(c+n))}if("Exif"!=e){console.log("Not valid EXIF data found");return 0}c+=6;var f=null;if(18761==b.getUint16(c)){f=!1}else if(19789==b.getUint16(c)){f=!0}else{console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)");return 0}if(42!=b.getUint16(c+2,!f)){console.log("Not valid TIFF data! (no 0x002A)");return 0}var g=b.getUint32(c+4,!f);if(8>g){console.log("Not valid TIFF data! (First offset less than 8)",b.getUint32(c+4,!f));return 0}for(var h=c+g,j=b.getUint16(h,!f),k=0,l;k<j;k++){l=h+12*k+2;if(274==b.getUint16(l,!f)){var m=b.getUint16(l+2,!f),o=b.getUint32(l+4,!f);if(3!=m&&1!=o){console.log("Invalid EXIF orientation value type ("+m+") or count ("+o+")");return 0}var p=b.getUint16(l+8,!f);if(1>p||8<p){console.log("Invalid EXIF orientation value ("+p+")");return 0}return p}}}else{c+=2+b.getUint16(c+2)}}return 0},fixOrientation:function fixOrientation(a,b,c){var d=new Image;d.addEventListener("load",function(){var a=document.createElement("canvas"),e=a.getContext("2d");if(5>b){a.width=d.width;a.height=d.height}else{a.width=d.height;a.height=d.width}switch(b){case 2:e.transform(-1,0,0,1,d.width,0);break;case 3:e.transform(-1,0,0,-1,d.width,d.height);break;case 4:e.transform(1,0,0,-1,0,d.height);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,d.height,0);break;case 7:e.transform(0,-1,-1,0,d.height,d.width);break;case 8:e.transform(0,-1,1,0,0,d.width);break;}e.drawImage(d,0,0);c.src=a.toDataURL()},!1);d.src=a},attach:function attach(b){if("string"==typeof b){b=document.getElementById(b)||document.querySelector(b)}if(!b){return this.dispatch("error",new c("Could not locate DOM element to attach to."))}this.container=b;b.innerHTML="";var e=document.createElement("div");b.appendChild(e);this.peg=e;if(!this.params.width)this.params.width=b.offsetWidth;if(!this.params.height)this.params.height=b.offsetHeight;if(!this.params.width||!this.params.height){return this.dispatch("error",new c("No width and/or height for webcam.  Please call set() first, or attach to a visible element."))}if(!this.params.dest_width)this.params.dest_width=this.params.width;if(!this.params.dest_height)this.params.dest_height=this.params.height;this.userMedia=d===void 0?this.userMedia:d;if(this.params.force_flash){d=this.userMedia;this.userMedia=null}if("number"!=typeof this.params.fps)this.params.fps=30;var g=this.params.width/this.params.dest_width,h=this.params.height/this.params.dest_height;if(this.userMedia){var i=document.createElement("video");i.setAttribute("autoplay","autoplay");i.setAttribute("playsinline","playsinline");i.style.width=""+this.params.dest_width+"px";i.style.height=""+this.params.dest_height+"px";if(1!=g||1!=h){b.style.overflow="hidden";i.style.webkitTransformOrigin="0px 0px";i.style.mozTransformOrigin="0px 0px";i.style.msTransformOrigin="0px 0px";i.style.oTransformOrigin="0px 0px";i.style.transformOrigin="0px 0px";i.style.webkitTransform="scaleX("+g+") scaleY("+h+")";i.style.mozTransform="scaleX("+g+") scaleY("+h+")";i.style.msTransform="scaleX("+g+") scaleY("+h+")";i.style.oTransform="scaleX("+g+") scaleY("+h+")";i.style.transform="scaleX("+g+") scaleY("+h+")"}b.appendChild(i);this.video=i;var j=this;this.mediaDevices.getUserMedia({audio:!1,video:this.params.constraints||{mandatory:{minWidth:this.params.dest_width,minHeight:this.params.dest_height}}}).then(function(b){i.onloadedmetadata=function(){j.stream=b;j.loaded=!0;j.live=!0;j.dispatch("load");j.dispatch("live");j.flip()};if("srcObject"in i){i.srcObject=b}else{i.src=a.URL.createObjectURL(b)}}).catch(function(a){if(j.params.enable_flash&&j.detectFlash()){setTimeout(function(){j.params.force_flash=1;j.attach(b)},1)}else{j.dispatch("error",a)}})}else if(this.iOS){var k=document.createElement("div");k.id=this.container.id+"-ios_div";k.className="webcamjs-ios-placeholder";k.style.width=""+this.params.width+"px";k.style.height=""+this.params.height+"px";k.style.textAlign="center";k.style.display="table-cell";k.style.verticalAlign="middle";k.style.backgroundRepeat="no-repeat";k.style.backgroundSize="contain";k.style.backgroundPosition="center";var l=document.createElement("span");l.className="webcamjs-ios-text";l.innerHTML=this.params.iosPlaceholderText;k.appendChild(l);var m=document.createElement("img");m.id=this.container.id+"-ios_img";m.style.width=""+this.params.dest_width+"px";m.style.height=""+this.params.dest_height+"px";m.style.display="none";k.appendChild(m);var o=document.createElement("input");o.id=this.container.id+"-ios_input";o.setAttribute("type","file");o.setAttribute("accept","image/*");o.setAttribute("capture","camera");var j=this,p=this.params;o.addEventListener("change",function(a){if(0<a.target.files.length&&0==a.target.files[0].type.indexOf("image/")){var b=URL.createObjectURL(a.target.files[0]),c=new Image;c.addEventListener("load",function(){var a=document.createElement("canvas");a.width=p.dest_width;a.height=p.dest_height;var b=a.getContext("2d");ratio=Math.min(c.width/p.dest_width,c.height/p.dest_height);var d=p.dest_width*ratio,e=p.dest_height*ratio,f=(c.width-d)/2,g=(c.height-e)/2;b.drawImage(c,f,g,d,e,0,0,p.dest_width,p.dest_height);var h=a.toDataURL();m.src=h;k.style.backgroundImage="url('"+h+"')"},!1);var d=new FileReader;d.addEventListener("load",function(a){var d=j.exifOrientation(a.target.result);if(1<d){j.fixOrientation(b,d,c)}else{c.src=b}},!1);var e=new XMLHttpRequest;e.open("GET",b,!0);e.responseType="blob";e.onload=function(){if(200==this.status||0===this.status){d.readAsArrayBuffer(this.response)}};e.send()}},!1);o.style.display="none";b.appendChild(o);k.addEventListener("click",function(){if(p.user_callback){j.snap(p.user_callback,p.user_canvas)}else{o.style.display="block";o.focus();o.click();o.style.display="none"}},!1);b.appendChild(k);this.loaded=!0;this.live=!0}else if(this.params.enable_flash&&this.detectFlash()){a.Webcam=f;var k=document.createElement("div");k.innerHTML=this.getSWFHTML();b.appendChild(k)}else{this.dispatch("error",new c(this.params.noInterfaceFoundText))}if(this.params.crop_width&&this.params.crop_height){var q=Math.floor(this.params.crop_width*g),r=Math.floor(this.params.crop_height*h);b.style.width=""+q+"px";b.style.height=""+r+"px";b.style.overflow="hidden";b.scrollLeft=Math.floor(this.params.width/2-q/2);b.scrollTop=Math.floor(this.params.height/2-r/2)}else{b.style.width=""+this.params.width+"px";b.style.height=""+this.params.height+"px"}},reset:function reset(){if(this.preview_active)this.unfreeze();this.unflip();if(this.userMedia){if(this.stream){if(this.stream.getVideoTracks){var a=this.stream.getVideoTracks();if(a&&a[0]&&a[0].stop)a[0].stop()}else if(this.stream.stop){this.stream.stop()}}delete this.stream;delete this.video}if(!0!==this.userMedia&&this.loaded&&!this.iOS){var b=this.getMovie();if(b&&b._releaseCamera)b._releaseCamera()}if(this.container){this.container.innerHTML="";delete this.container}this.loaded=!1;this.live=!1},set:function set(){if(1==arguments.length){for(var a in arguments[0]){this.params[a]=arguments[0][a]}}else{this.params[arguments[0]]=arguments[1]}},on:function on(a,b){a=a.replace(/^on/i,"").toLowerCase();if(!this.hooks[a])this.hooks[a]=[];this.hooks[a].push(b)},off:function off(a,b){a=a.replace(/^on/i,"").toLowerCase();if(this.hooks[a]){if(b){var c=this.hooks[a].indexOf(b);if(-1<c)this.hooks[a].splice(c,1)}else{this.hooks[a]=[]}}},dispatch:function dispatch(){var d=arguments[0].replace(/^on/i,"").toLowerCase(),e=Array.prototype.slice.call(arguments,1);if(this.hooks[d]&&this.hooks[d].length){for(var f=0,g=this.hooks[d].length,h;f<g;f++){h=this.hooks[d][f];if("function"==typeof h){h.apply(this,e)}else if("object"==_typeof(h)&&2==h.length){h[0][h[1]].apply(h[0],e)}else if(a[h]){a[h].apply(a,e)}}return!0}else if("error"==d){var i;if(e[0]instanceof b||e[0]instanceof c){i=e[0].message}else{i="Could not access webcam: "+e[0].name+": "+e[0].message+" "+e[0].toString()}alert("Webcam.js Error: "+i)}return!1},setSWFLocation:function setSWFLocation(a){this.set("swfURL",a)},detectFlash:function detectFlash(){var b=navigator,c=!1;if("undefined"!=typeof b.plugins&&"object"===_typeof(b.plugins["Shockwave Flash"])){var d=b.plugins["Shockwave Flash"].description;if(d&&"undefined"!=typeof b.mimeTypes&&b.mimeTypes["application/x-shockwave-flash"]&&b.mimeTypes["application/x-shockwave-flash"].enabledPlugin){c=!0}}else if("undefined"!=typeof a.ActiveXObject){try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(e){var f=e.GetVariable("$version");if(f)c=!0}}catch(a){}}return c},getSWFHTML:function getSWFHTML(){var c="",d=this.params.swfURL;if(location.protocol.match(/file/)){this.dispatch("error",new b("Flash does not work from local disk.  Please run from a web server."));return"<h3 style=\"color:red\">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>"}if(!this.detectFlash()){this.dispatch("error",new b("Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again."));return"<h3 style=\"color:red\">"+this.params.flashNotDetectedText+"</h3>"}if(!d){for(var e="",f=document.getElementsByTagName("script"),g=0,h=f.length,i;g<h;g++){i=f[g].getAttribute("src");if(i&&i.match(/\/webcam(\.min)?\.js/)){e=i.replace(/\/webcam(\.min)?\.js.*$/,"");g=h}}if(e)d=e+"/webcam.swf";else d="webcam.swf"}if(a.localStorage&&!localStorage.getItem("visited")){this.params.new_user=1;localStorage.setItem("visited",1)}var j="";for(var k in this.params){if(j)j+="&";j+=k+"="+escape(this.params[k])}c+="<object classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" type=\"application/x-shockwave-flash\" codebase=\""+this.protocol+"://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0\" width=\""+this.params.width+"\" height=\""+this.params.height+"\" id=\"webcam_movie_obj\" align=\"middle\"><param name=\"wmode\" value=\"opaque\" /><param name=\"allowScriptAccess\" value=\"always\" /><param name=\"allowFullScreen\" value=\"false\" /><param name=\"movie\" value=\""+d+"\" /><param name=\"loop\" value=\"false\" /><param name=\"menu\" value=\"false\" /><param name=\"quality\" value=\"best\" /><param name=\"bgcolor\" value=\"#ffffff\" /><param name=\"flashvars\" value=\""+j+"\"/><embed id=\"webcam_movie_embed\" src=\""+d+"\" wmode=\"opaque\" loop=\"false\" menu=\"false\" quality=\"best\" bgcolor=\"#ffffff\" width=\""+this.params.width+"\" height=\""+this.params.height+"\" name=\"webcam_movie_embed\" align=\"middle\" allowScriptAccess=\"always\" allowFullScreen=\"false\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\" flashvars=\""+j+"\"></embed></object>";return c},getMovie:function getMovie(){if(!this.loaded)return this.dispatch("error",new b("Flash Movie is not loaded yet"));var a=document.getElementById("webcam_movie_obj");if(!a||!a._snap)a=document.getElementById("webcam_movie_embed");if(!a)this.dispatch("error",new b("Cannot locate Flash movie in DOM"));return a},freeze:function freeze(){var a=this,b=this.params;if(this.preview_active)this.unfreeze();var c=this.params.width/this.params.dest_width,d=this.params.height/this.params.dest_height;this.unflip();var e=b.crop_width||b.dest_width,f=b.crop_height||b.dest_height,g=document.createElement("canvas");g.width=e;g.height=f;var h=g.getContext("2d");this.preview_canvas=g;this.preview_context=h;if(1!=c||1!=d){g.style.webkitTransformOrigin="0px 0px";g.style.mozTransformOrigin="0px 0px";g.style.msTransformOrigin="0px 0px";g.style.oTransformOrigin="0px 0px";g.style.transformOrigin="0px 0px";g.style.webkitTransform="scaleX("+c+") scaleY("+d+")";g.style.mozTransform="scaleX("+c+") scaleY("+d+")";g.style.msTransform="scaleX("+c+") scaleY("+d+")";g.style.oTransform="scaleX("+c+") scaleY("+d+")";g.style.transform="scaleX("+c+") scaleY("+d+")"}this.snap(function(){g.style.position="relative";g.style.left=""+a.container.scrollLeft+"px";g.style.top=""+a.container.scrollTop+"px";a.container.insertBefore(g,a.peg);a.container.style.overflow="hidden";a.preview_active=!0},g)},unfreeze:function unfreeze(){if(this.preview_active){this.container.removeChild(this.preview_canvas);delete this.preview_context;delete this.preview_canvas;this.preview_active=!1;this.flip()}},flip:function flip(){if(this.params.flip_horiz){var a=this.container.style;a.webkitTransform="scaleX(-1)";a.mozTransform="scaleX(-1)";a.msTransform="scaleX(-1)";a.oTransform="scaleX(-1)";a.transform="scaleX(-1)";a.filter="FlipH";a.msFilter="FlipH"}},unflip:function unflip(){if(this.params.flip_horiz){var a=this.container.style;a.webkitTransform="scaleX(1)";a.mozTransform="scaleX(1)";a.msTransform="scaleX(1)";a.oTransform="scaleX(1)";a.transform="scaleX(1)";a.filter="";a.msFilter=""}},savePreview:function savePreview(a,b){var c=this.params,d=this.preview_canvas,e=this.preview_context;if(b){var f=b.getContext("2d");f.drawImage(d,0,0)}a(b?null:d.toDataURL("image/"+c.image_format,c.jpeg_quality/100),d,e);if(this.params.unfreeze_snap)this.unfreeze()},snap:function snap(a,b){if(!a)a=this.params.user_callback;if(!b)b=this.params.user_canvas;var d=this,e=this.params;if(!this.loaded)return this.dispatch("error",new c("Webcam is not loaded yet"));if(!a)return this.dispatch("error",new c("Please provide a callback function or canvas to snap()"));if(this.preview_active){this.savePreview(a,b);return null}var f=document.createElement("canvas");f.width=this.params.dest_width;f.height=this.params.dest_height;var g=f.getContext("2d");if(this.params.flip_horiz){g.translate(e.dest_width,0);g.scale(-1,1)}var h=function(){if(this.src&&this.width&&this.height){g.drawImage(this,0,0,e.dest_width,e.dest_height)}if(e.crop_width&&e.crop_height){var c=document.createElement("canvas");c.width=e.crop_width;c.height=e.crop_height;var d=c.getContext("2d");d.drawImage(f,Math.floor(e.dest_width/2-e.crop_width/2),Math.floor(e.dest_height/2-e.crop_height/2),e.crop_width,e.crop_height,0,0,e.crop_width,e.crop_height);g=d;f=c}if(b){var h=b.getContext("2d");h.drawImage(f,0,0)}a(b?null:f.toDataURL("image/"+e.image_format,e.jpeg_quality/100),f,g)};if(this.userMedia){g.drawImage(this.video,0,0,this.params.dest_width,this.params.dest_height);h()}else if(this.iOS){var i=document.getElementById(this.container.id+"-ios_div"),j=document.getElementById(this.container.id+"-ios_img"),k=document.getElementById(this.container.id+"-ios_input");iFunc=function(a){function b(){return a.apply(this,arguments)}b.toString=function(){return a.toString()};return b}(function(){h.call(j);j.removeEventListener("load",iFunc);i.style.backgroundImage="none";j.removeAttribute("src");k.value=null});if(!k.value){j.addEventListener("load",iFunc);k.style.display="block";k.focus();k.click();k.style.display="none"}else{iFunc(null)}}else{var l=this.getMovie()._snap(),j=new Image;j.onload=h;j.src="data:image/"+this.params.image_format+";base64,"+l}return null},configure:function configure(a){if(!a)a="camera";this.getMovie()._configure(a)},flashNotify:function flashNotify(a,c){switch(a){case"flashLoadComplete":this.loaded=!0;this.dispatch("load");break;case"cameraLive":this.live=!0;this.dispatch("live");break;case"error":this.dispatch("error",new b(c));break;default:break;}},b64ToUint6:function b64ToUint6(a){return 64<a&&91>a?a-65:96<a&&123>a?a-71:47<a&&58>a?a+4:43===a?62:47===a?63:0},base64DecToArr:function base64DecToArr(a,b){for(var c=a.replace(/[^A-Za-z0-9\+\/]/g,""),d=c.length,e=b?Math.ceil((3*d+1>>2)/b)*b:3*d+1>>2,f=new Uint8Array(e),g,h,i=0,j=0,k=0;k<d;k++){h=3&k;i|=this.b64ToUint6(c.charCodeAt(k))<<18-6*h;if(3===h||1==d-k){for(g=0;3>g&&j<e;g++,j++){f[j]=255&i>>>(24&16>>>g)}i=0}}return f},upload:function upload(a,b,c){var d=this.params.upload_name||"webcam",e="";if(a.match(/^data\:image\/(\w+)/))e=RegExp.$1;else throw"Cannot locate image format in Data URI";var g=a.replace(/^data\:image\/\w+\;base64\,/,""),h=new XMLHttpRequest;h.open("POST",b,!0);if(h.upload&&h.upload.addEventListener){h.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=a.loaded/a.total;f.dispatch("uploadProgress",b,a)}},!1)}var i=this;h.onload=function(){if(c)c.apply(i,[h.status,h.responseText,h.statusText]);f.dispatch("uploadComplete",h.status,h.responseText,h.statusText)};var j=new Blob([this.base64DecToArr(g)],{type:"image/"+e}),k=new FormData;k.append(d,j,d+"."+e.replace(/e/,""));h.send(k)}};f.init();if("function"==typeof define&&define.amd){define ("quizaccess_mproctoring/webcam",function(){return f})}else if("object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports){module.exports=f}else{a.Webcam=f}})(window);
//# sourceMappingURL=webcam.min.js.map
