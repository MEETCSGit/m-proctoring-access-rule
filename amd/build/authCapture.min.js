require.config({paths:{"datatables.net":"//cdn.datatables.net/1.10.21/js/jquery.dataTables.min"}});function loadCss(a){var b=document.createElement("link");b.type="text/css";b.rel="stylesheet";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)}define ("quizaccess_mproctoring/authCapture",["jquery"],function(a){return{init:function init(b){var h,i,j,k=!1,l=!1;loadCss("accessrule/mproctoring/cam.css");a("body").append("<div class=\"modal fade\" id=\"myModal\" role=\"dialog\"><div class=\"modal-dialog modal-lg\"> <div class=\"modal-content\"><div class=\"modal-header\">  <h2><b><center>Validate Yourself</center></b></h2>          </div>              <div class=\"modal-body\">  <center> <h3> Face Capture</h3></center><h4 style=\"color:red;\"><b>Instructions: </b></h4><br><h6 style=\"color:red;\">1. There is no backgorund image When capturing face. </h6><h6 style=\"color:red;\">2. More than one person for capture face authentication fails.   </h6> <br><div class=\"row\">    <div class=\"col-6\">       <div class=\"camera\"><center>  <label><h3> Step 1 </h3></label> </center><video id=\"video\">Video stream not available.</video> <button id=\"startbutton\">Take photo</button> </div></div><div class=\"col-6\"><canvas id=\"canvas\"></canvas><div class=\"output\"><center> <label><h3> Step 2 </h3></label></center><img id=\"photo\" alt=\"The screen capture will appear in this box.\">  <button id=\"validCap\">validate</button>   </div>   </div> </div>    <center><h3>Identity Card Capture</h3></center><h4 style=\"color:red;\"><b>Instructions: </b></h4><br><h6 style=\"color:red;\">Please bring ID card on front on camera</h6> <br><div class=\"row\">    <div class=\"col-6\">         <div class=\"camera\"><center> <label><h3> Step 3 </h3></label></center>  <video id=\"videopan\">Video stream not available.</video> <button id=\"startpan\">Take photo</button> </div></div><div class=\"col-6\"><canvas id=\"canvaspan\"></canvas><div class=\"output\"> <center> <label><h3> Step 4 </h3></label></center><img id=\"photopan\" alt=\"The screen capture will appear in this box.\">  </div>   </div>         </div>              <div class=\"modal-footer\">      <span style=\"color:red;\"> Confirm button will not be enabled till all the 4 steps are done.  </span>  <button type=\"button\" class=\"btn btn-success\" id=\"camConfirm\">Confirm</button>       <button type=\"button\" class=\"btn btn-default\" id=\"camClose\" data-dismiss=\"modal\">Close</button></div></div></div></div>");a("</br>");a(".quizattempt").prepend(a("<button/>",{id:"btnCap",class:"btn btn-secondary"}),a("</br>"),a("</br>"));a("#btnCap").text(" Step 1 : Authenticate Yourself");a("#btnCap").click(function(){a("#myModal").modal("show");c()});a("#camClose").click(function(){h.getTracks().forEach(function(a){a.stop()})});a("#camConfirm").click(function(){a.ajax({method:"POST",url:b+"/mod/quiz/accessrule/mproctoring/api/capture_id_face.php",data:{imgdataface:i,imgdataid:j},success:function success(a){if("done"==a){alert("Authentication successful. Click on Attempt quiz to proceed");window.location.reload()}else{alert("Error in Authentication")}}})});a("#validCap").click(function(){a("#validCap").html("please wait...");a("#validCap").css("background-color","red");a.ajax({method:"POST",url:b+"/mod/quiz/accessrule/mproctoring/api/face_count.php",data:{imgdata:i},success:function success(b){if("1"==b){k=!0;alert("Face Validation Successful");a("#validCap").html("&#10004;validated");a("#validCap").css("background-color","green");if(k&&l){a("#camConfirm").prop("disabled",!1)}}else{alert("Face could not be detected.<br>Multiple faces detected. Only one person is allowed. Kindly re-take.");a("#validCap").html("validate");a("#validCap").css("background-color","orange")}}})});var m=0,n=!1,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null;function c(){o=document.getElementById("video");p=document.getElementById("canvas");q=document.getElementById("photo");r=document.getElementById("startbutton");s=document.getElementById("videopan");t=document.getElementById("canvaspan");u=document.getElementById("photopan");v=document.getElementById("startpan");navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){h=a;o.srcObject=a;o.play();s.srcObject=a;s.play()}).catch(function(a){console.log("An error occurred: "+a)});o.addEventListener("canplay",function(){if(!n){m=o.videoHeight/(o.videoWidth/320);if(isNaN(m)){m=240}o.setAttribute("width",320);o.setAttribute("height",m);p.setAttribute("width",320);p.setAttribute("height",m);n=!0}},!1);s.addEventListener("canplay",function(){if(!n){m=s.videoHeight/(s.videoWidth/320);if(isNaN(m)){m=240}s.setAttribute("width",320);s.setAttribute("height",m);t.setAttribute("width",320);t.setAttribute("height",m);n=!0}},!1);a("#camConfirm").prop("disabled",!0);a("#validCap").prop("disabled",!0);r.addEventListener("click",function(b){a("#validCap").prop("disabled",!1);a("#startbutton").text("Retake Photo");f();b.preventDefault()},!1);v.addEventListener("click",function(b){l=!0;g();if(k&&l){a("#camConfirm").prop("disabled",!1)}b.preventDefault()},!1);d();e()}function d(){var a=p.getContext("2d");a.fillStyle="#AAA";a.fillRect(0,0,p.width,p.height);var b=p.toDataURL("image/png");q.setAttribute("src",b)}function e(){var a=t.getContext("2d");a.fillStyle="#AAA";a.fillRect(0,0,t.width,t.height);var b=t.toDataURL("image/png");u.setAttribute("src",b)}function f(){var a=p.getContext("2d");if(m){p.width=320;p.height=m;a.drawImage(o,0,0,320,m);i=p.toDataURL("image/png");var b=p.toDataURL("image/png");q.setAttribute("src",b)}else{d()}}function g(){var a=t.getContext("2d");if(m){t.width=320;t.height=m;a.drawImage(s,0,0,320,m);var b=t.toDataURL("image/png");j=t.toDataURL("image/png");u.setAttribute("src",b)}else{e()}}}}});
//# sourceMappingURL=authCapture.min.js.map
